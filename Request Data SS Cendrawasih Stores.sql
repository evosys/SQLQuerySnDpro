

select name,kode_outlet,outlet_name,[201601],
[201602],[201603],[201604],[201605],[201606],[201607],[201608],[201609],[201610],[201611],[201612],[201613],[201614],[201615],[201616],[201617],
[201618],[201619],[201620],[201621],[201622],[201623],[201624],[201625],[201626],[201627],[201628],[201629],[201630],[201631],[201632],[201633],
[201634],[201635],[201636],[201637],[201638],[201639],[201640],[201641],[201642],[201643],[201644],[201645],[201646],[201647],[201648],[201649],
[201650],[201651],[201652],[201701],[201702],[201703],[201704],[201705],[201706],[201707],[201708],[201709],[201710],[201711],[201712],[201713],
[201714],[201715],[201716],[201717],[201718],[201719],[201720],[201721],[201722],[201723],[201724],[201725],[201726],[201727],[201728],[201729],
[201730],[201731],[201732],[201733],[201734],[201735],[201736],[201737],[201738],[201739],[201740],[201741],[201742],[201743],[201744],[201745],
[201746],[201747],[201748],[201749],[201750],[201751],[201752]
from
(
	select cd.distributor+cd.TOWN+cd.LOCALITY+cd.slocality+cd.pop kode_outlet ,d.name,
	sum(cd.net_amount) as 'Gross', jc.YEAR+jc.WEEK_NO JCY
	, p.name outlet_name
	from cashmemo cd 
join (select DISTRIBUTOR,name from DISTRIBUTOR)d on cd.DISTRIBUTOR=d.DISTRIBUTOR
join JC_WEEK jc on cd.doc_date between jc.start_date and jc.end_date
join pop p on cd.distributor+cd.TOWN+cd.LOCALITY+cd.slocality+cd.pop = p.distributor+p.town+p.locality+p.slocality+p.pop
where cd.visit_type='02' and cd.sub_document='01' and  YEAR(cd.DOC_DATE) in ('2016','2017')
and cd.DISTRIBUTOR+cd.TOWN+cd.LOCALITY+cd.SLOCALITY+cd.POP in (
'94228001340215000300204333',
'94228001340405000200204050',
'94228001340401000300203742',
'94228001340207000300204207',
'94228001340214000100204217',
'94228001340207000400204582',
'94228001340207000300916967',
'94228001340404000600204327',
'94228001340207000400204366',
'94228001340202000300204235',
'94228001340404000200203963',
'94228001340404000500203825',
'94228001340203000500204287',
'15195745340408000300180007',
'15195745340212000300180309',
'15195745340213000800179755',
'15195745340407000100180308',
'15195745340407000200179716',
'15195745340213000600179978',
'15195745340213000600180306',
'15195745340212000100179940',
'15195745340407000200920285',
'15195745340213000800180265',
'94282001340215000400205737',
'94282001347111000100205519',
'94282001340215000200205749',
'94282001340215000300206418',
'94282001340213000400206077',
'94282001340213000400205492',
'94282001340208000100206347',
'94282001340213000500205823',
'94282001340214000300759999',
'94282001340214000400668180',
'15204972340407000100180526',
'15204972347114000400180427',
'15204972340405000300928387',
'15300300340415000100202042',
'15300300340406000300202462',
'15300300340407000300202859',
'15300300340413000300202503',
'15300300340412000100202391',
'15300300340406000500202804',
'15300300340412000100202738',
'15300300340417000500202073',
'94210001340407000100358939',
'94210001340411000100358994',
'94210001340407000300358935',
'94210001340412000500358990',
'94210001340413000400359029',
'94210001340407000300358929',
'94210001340407000300358998',
'94210001340408000400359002'
)
group by cd.distributor+cd.TOWN+cd.LOCALITY+cd.slocality+cd.pop,p.name,d.NAME,jc.YEAR+jc.WEEK_NO


) d
pivot
(
  max(gross)
  for JCY in (
[201601],
[201602],[201603],[201604],[201605],[201606],[201607],[201608],[201609],[201610],[201611],[201612],[201613],[201614],[201615],[201616],[201617],
[201618],[201619],[201620],[201621],[201622],[201623],[201624],[201625],[201626],[201627],[201628],[201629],[201630],[201631],[201632],[201633],
[201634],[201635],[201636],[201637],[201638],[201639],[201640],[201641],[201642],[201643],[201644],[201645],[201646],[201647],[201648],[201649],
[201650],[201651],[201652],[201701],[201702],[201703],[201704],[201705],[201706],[201707],[201708],[201709],[201710],[201711],[201712],[201713],
[201714],[201715],[201716],[201717],[201718],[201719],[201720],[201721],[201722],[201723],[201724],[201725],[201726],[201727],[201728],[201729],
[201730],[201731],[201732],[201733],[201734],[201735],[201736],[201737],[201738],[201739],[201740],[201741],[201742],[201743],[201744],[201745],
[201746],[201747],[201748],[201749],[201750],[201751],[201752])
	
)piv;

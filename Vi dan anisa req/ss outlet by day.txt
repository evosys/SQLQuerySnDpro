select dlv.COMP2_DESC Region,dlv.COMP3_DESC Area ,p.distributor,dt.NAME ,
p.TOWN+p.LOCALITY+p.SLOCALITY+p.POP code_le,replace(p.name,char(9),'') Outlet_name ,case 
	when p.active = 1 then 'Active'
	when p.active = 0 then 'InActive'
end Store_ActiveClosed,
elm.LDESC Outlet_element ,elm.Desc_se Outlet_SubElement,
[20180701],	[20180702],	[20180703],	[20180704],	[20180705],	[20180706],	[20180707],	[20180708],	[20180709],	[20180710],	[20180711],	[20180712],	[20180713],	[20180714],	[20180715],	[20180716],	[20180717],	[20180718],	[20180719],	[20180720],	[20180721],	[20180722],	[20180723],	[20180724],	[20180725],	[20180726],	[20180727],	[20180728],	[20180729],	[20180730],	[20180731],	[20180801],	[20180802],	[20180803],	[20180804],	[20180805],	[20180806],	[20180807],	[20180808],	[20180809],	[20180810],	[20180811],	[20180812],	[20180813],	[20180814],	[20180815],	[20180816],	[20180817],	[20180818],	[20180819],	[20180820],	[20180821],	[20180822],	[20180823],	[20180824],	[20180825],	[20180826],	[20180827],	[20180828],	[20180829],	[20180830],	[20180831],	[20180901],	[20180902],	[20180903],	[20180904],	[20180905],	[20180906],	[20180907],	[20180908],	[20180909],	[20180910],	[20180911],	[20180912],	[20180913],	[20180914],	[20180915],	[20180916],	[20180917],	[20180918],	[20180919],	[20180920],	[20180921],	[20180922],	[20180923],	[20180924],	[20180925],	[20180926],	[20180927],	[20180928],	[20180929],	[20180930]
from pop p
	join (select se.SUB_ELEMENT,se.LDESC Desc_se ,e.ELEMENT,e.LDESC from SUB_ELEMENT se 
		join ELEMENT e on e.ELEMENT = se.ELEMENT and e.CHANNEL =se.CHANNEL and e.SUB_CHANNEL = se.SUB_CHANNEL and e.MASTER_CHANNEL =se.MASTER_CHANNEL
	) elm on elm.SUB_ELEMENT = p.SUB_ELEMENT
	join (
		select da.DISTRIBUTOR,da.VALUE_COMB,clvl.comp2_desc ,clvl.comp3_desc from DISTRIBUTOR_ASSOCIATION da
		join
		vw_complevel clvl on da.VALUE_COMB= clvl.COMPCODE 
		join 
		( 
			select distinct DISTRIBUTOR, COUNT (DISTRIBUTOR) AS CNT from DISTRIBUTOR_ASSOCIATION
			where FIELD_COMB = 'compcode'
			group by DISTRIBUTOR
		) dbl on da.SEQ_NO= dbl.CNT and dbl.DISTRIBUTOR =da.DISTRIBUTOR
	) dlv on p.distributor = dlv.distributor
	left join DISTRIBUTOR dt on dt.DISTRIBUTOR =p.DISTRIBUTOR
left join (
select distinct  code_pop,[20180701],	[20180702],	[20180703],	[20180704],	[20180705],	[20180706],	[20180707],	[20180708],	[20180709],	[20180710],	[20180711],	[20180712],	[20180713],	[20180714],	[20180715],	[20180716],	[20180717],	[20180718],	[20180719],	[20180720],	[20180721],	[20180722],	[20180723],	[20180724],	[20180725],	[20180726],	[20180727],	[20180728],	[20180729],	[20180730],	[20180731],	[20180801],	[20180802],	[20180803],	[20180804],	[20180805],	[20180806],	[20180807],	[20180808],	[20180809],	[20180810],	[20180811],	[20180812],	[20180813],	[20180814],	[20180815],	[20180816],	[20180817],	[20180818],	[20180819],	[20180820],	[20180821],	[20180822],	[20180823],	[20180824],	[20180825],	[20180826],	[20180827],	[20180828],	[20180829],	[20180830],	[20180831],	[20180901],	[20180902],	[20180903],	[20180904],	[20180905],	[20180906],	[20180907],	[20180908],	[20180909],	[20180910],	[20180911],	[20180912],	[20180913],	[20180914],	[20180915],	[20180916],	[20180917],	[20180918],	[20180919],	[20180920],	[20180921],	[20180922],	[20180923],	[20180924],	[20180925],	[20180926],	[20180927],	[20180928],	[20180929],	[20180930]
from 
(select cm.DISTRIBUTOR+cm.town+cm.locality+cm.slocality+cm.pop code_pop ,convert(varchar, cm.DOC_DATE, 112) DATES ,sum(cm.net_amount) net
 from cashmemo cm 
where visit_type <> '88'
and year(cm.DOC_DATE) ='2018' and MONTH(cm.doc_date) in ('08','09','07')
group by cm.DISTRIBUTOR+cm.town+cm.locality+cm.slocality+cm.pop , cm.DOC_DATE) x
pivot
    (
      sum(Net) for DATES in ( [20180701],	[20180702],	[20180703],	[20180704],	[20180705],	[20180706],	[20180707],	[20180708],	[20180709],	[20180710],	[20180711],	[20180712],	[20180713],	[20180714],	[20180715],	[20180716],	[20180717],	[20180718],	[20180719],	[20180720],	[20180721],	[20180722],	[20180723],	[20180724],	[20180725],	[20180726],	[20180727],	[20180728],	[20180729],	[20180730],	[20180731],	[20180801],	[20180802],	[20180803],	[20180804],	[20180805],	[20180806],	[20180807],	[20180808],	[20180809],	[20180810],	[20180811],	[20180812],	[20180813],	[20180814],	[20180815],	[20180816],	[20180817],	[20180818],	[20180819],	[20180820],	[20180821],	[20180822],	[20180823],	[20180824],	[20180825],	[20180826],	[20180827],	[20180828],	[20180829],	[20180830],	[20180831],	[20180901],	[20180902],	[20180903],	[20180904],	[20180905],	[20180906],	[20180907],	[20180908],	[20180909],	[20180910],	[20180911],	[20180912],	[20180913],	[20180914],	[20180915],	[20180916],	[20180917],	[20180918],	[20180919],	[20180920],	[20180921],	[20180922],	[20180923],	[20180924],	[20180925],	[20180926],	[20180927],	[20180928],	[20180929],	[20180930]) ) as PVT
) cmn on p.distributor+p.TOWN+p.LOCALITY+p.SLOCALITY+p.POP =cmn.code_pop
where p.TOWN+p.LOCALITY+p.SLOCALITY+p.POP in ('327601000600349909',
'357815001000001300',
'351516001600001351',
'217108000500578817',
'327606000100351329',
'327606000100349874',
'137110000100647354',
'357812000400001306',
'357813000300001325',
'331112000400378945',
'332810000400397746',
'332810000400397769',
'320320000200399813',
'320320000500950553',
'351516001600001397',
'357812000400001301',
'352216000900043836',
'357813000300001390',
'327601000700349914',
'317101000500391240',
'320320001100869544',
'351507002000021498',
'350806001800030724',
'357812000400001305',
'357815001000001309',
'317101000500391239',
'327601000700349911',
'327604000900351342',
'327604001200351354',
'327601000500349875',
'351516002300027700',
'352216000900043833',
'327805000400380576',
'327805000400380597',
'331112000400378966',
'137110000100647376',
'167105000200548522',
'167105000200548520',
'331112000400378968',
'337202000100378938',
'331112000400378988',
'337202000100378983',
'367103001701011958',
'367103001701011957',
'367103001701011959',
'350806001800046897',
'357815001000001324',
'351018000500119733',
'327602000700351343',
'157104000400700177',
'157102000700700173',
'360317000400361534',
'360305000200361533',
'350110000100038918',
'357102001700128665',
'350905000400030765',
'351210001300030740',
'360312100400361531',
'217106100300578822',
'217108100200578840',
'217107000400578793',
'217105100301023507',
'217104100100578828',
'217106100100916936',
'330273000400173472',
'327305000500402741',
'327507000400064502',
'327604100300351352',
'351514001100598993',
'357811000400001385',
'351606001300001443',
'351513000900001343',
'351018000400600257',
'350971000200030734',
'351212000800089459',
'357808000400001363',
'352216000800043829',
'352313001500043831',
'352509001000038927',
'357826000300001376',
'350804000800759065',
'357805000300001368',
'327901000500918865',
'320320000700399841',
'320312000300399828',
'167102001100964709',
'167103100300964710',
'167106000900964711',
'167102001100548511',
'167108100400548525',
'167108100300548550',
'167106100400548512',
'157108000300700226',
'320320000300399830',
'320322000500399833',
'320317001100399834',
'327325000300402736',
'320320000500399832',
'320314000700960441',
'320320000800399831',
'320314000700399829',
'320313001200399842',
'320710000900362591',
'327403000300390111',
'320912002400400672',
'137105003200647355',
'137105003000647369',
'137106003300647439',
'157105000400700110',
'357602000600001455',
'647202000700443241',
'127511000100571822',
'327903000500966156',
'327506100300009251',
'350217001400036420',
'327326000300402735',
'327601100400393338',
'357823000200001296',
'351007000500094462',
'351012001100601961',
'350216001000036429',
'357701000400036390',
'357811000600001304',
'357805000100001378',
'357809000200598985',
'317403000300004568',
'321511200100069483',
'320519000900402808',
'317501000500015419',
'332816000200397774',
'347104000600358937',
'340213000800358971',
'137108000500647364',
'347109000200358925',
'330519000900135297',
'357816000200001310',
'317303000500012873',
'647202001400424382',
'647206100200424385',
'351010000300030725',
'327601100700349910',
'352611001000122533',
'357812000300001377',
'351508000900001379',
'357403100600127914',
'357815000600001292',
'350614000800036360',
'367406000900393396',
'320319001600956245',
'350971000400030733',
'350412001400036424',
'351318000400030722',
'357804000300598998',
'357820000100001372',
'357825000300001392',
'351814000400036418',
'360303000400361528',
'351315000600030759',
'350913000400665911',
'350412001400036428',
'367405000200393350',
'327602100200351353',
'327603001000351351',
'327901000500362618',
'357824000200001333',
'320122100600349890',
'327606100200977058',
'327603000800963680',
'351516001400001332',
'350806001800046896',
'357810000200001293',
'357810000600001362',
'352313001300043827',
'351713001200026110',
'357811000600001388',
'327805000400957124',
'317102000100932337',
'337408000200353280',
'331901001300380629',
'337408000100353251',
'331810001500380630',
'337403000500353254',
'337405000100353248',
'157101000100700111',
'332708001500397744',
'332812001200397777',
'187104000500588902',
'331072000800378943',
'157101000100761341',
'330512002400159483',
'330118000900166899',
'167103001000548524',
'167108000400548523',
'167106100500548521',
'331104000500984739',
'320816001300395934',
'317404000700004580',
'330220000100173500',
'347106000300358926',
'332917000900397736',
'340407000100358978',
'647206100300443222',
'217105100300578772',
'217107000500578762',
'517101000100939620',
'357301000900123501',
'747101400400812571',
'127512000200990287',
'827102000900790050',
'350729000200123507',
'127507000100983934',
'357303000300108048',
'360313000300361535',
'647101000400429703',
'217108000500578782',
'647101000400429636',
'120721000700565754',
'127513000200571864',
'127513000200571862',
'510503001100059724',
'717301001200816051',
'647202200300929172',
'647205000800443231',
'147102200400645685',
'717105200600993807',
'941203001300865735',
'717301001200816053',
'817102001100868524',
'517103100300050348',
'217108000500578823',
'147102200400645687',
'530312100400816799',
'941203000500865737',
'510503001100059685',
'127505001100571800',
'127505001100571799',
'617103000600439835',
'827102101300790047',
'510301000400058562',
'510301000400058597',
'510301000400058545',
'817102001100868526',
'617103000600439844',
'617103000600439845',
'827102101300790051',
'947102001200867082',
'947102001200867088',
'717105200600993806',
'120721000700565678',
'941203001300865740',
'941203000500865726',
'647104000600429696',
'147107000600645809',
'121220001500571843',
'127520000100571846',
'127507000300571845',
'127602000600571844',
'351713001200026085',
'647202000900443197',
'217105100400578790',
'147101000100645515',
'717403000500817710',
'197104100200625348',
'127508000100924884',
'727103100600800517',
'727103000200800518',
'737111001100695356',
'717403000300817711',
'717301000900816054',
'147107000400645684',
'647203000200443257',
'647202001400443225',
'640309000400457232',
'537104100200815315',
'731406000400713116',
'717302000200816052',
'727102000700800515',
'537104001400816632',
'510303000600047868',
'517103100900047867',
'217107000100578841',
'217108100100578836',
'147101000800645686',
'917101000300864597',
'537104001101000555',
'127504000500571802',
'127514000500571795',
'127512000200946945',
'127518000100571797',
'127517000700571801',
'127506001100571803',
'127507000600571796',
'127503000100571794',
'127519000100571798',
'127514000100571806',
'730603002200714921',
'147102100500645616',
'147103000100761706',
'147102001100645594',
'537103100400815323',
'127508000400571805',
'737110100100695355',
'147102000700645540',
'730403000700714932',
'537103000900815318',
'527103001300053521',
'817102001500868525',
'527103000600053520',
'527103001100053511',
'737202000100713140',
'731003000200713147',
'731403000700713112',
'617101000500439829',
'117102001100549519',
'117103100200549518',
'537102000500815319',
'917102200200864623',
'947103000500924744',
'947102100500988858',
'947104000300877718',
'947104000100866701',
'737102000900695357',
'737106000100700132',
'111006101400962553',
'111115100600988387',
'120722000500565679',
'140902003200565736',
'747102000300812546',
'510401000700047378',
'121220000900571881',
'121226000700571882',
'121226000800571883',
'127506000400571885',
'127520000200571884',
'127303000300586831',
'647101000700931788',
'352612001000122534',
'352611001000122529',
'332810000901023251',
'352509000500038919',
'352315000500001162',
'352425000300107506',
'352425000800107424',
'352308001500001323',
'357807000600023170',
'357805000300967187',
'350105001800038930',
'357804000200022986',
'337204001000378977',
'317308000400004575',
'157102000200975576',
'157108000400700218',
'157101001000700219',
'510301000400058616',
'510301000400058605',
'510301000201050018',
'510401000100047375',
'510405000600047361',
'517103000100047896',
'517101000600050417',
'517103100300050410',
'517101000700050434',
'647204000700443220',
'647205000800443227',
'647206001100443219')
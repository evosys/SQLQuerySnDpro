select cm.DISTRIBUTOR,cm.TOWN+cm.LOCALITY+cm.SLOCALITY+cm.POP as 'Outlet Code',cm.DSR as 'Salesman',ds.NAME as 'Salesman Name',
MONTH(cm.doc_date) as 'Calendar Month',
cm.DOC_NO as 'Invoice No',((cm.net_amount/1.1)-cm.tot_discount) as 'GSV(Amount)',ct.LDESC as 'Cashmemo Type'
from CASHMEMO cm
left join DSR ds on ds.DISTRIBUTOR = cm.DISTRIBUTOR and ds.DSR = cm.DSR
left join CASHMEMO_TYPE ct on ct.CASHMEMO_TYPE = cm.CASHMEMO_TYPE
where cm.DOC_DATE between '20200201' and getdate()
and cm.VISIT_TYPE = '02' and cm.CASHMEMO_TYPE in ('05','06')
order by MONTH(cm.DOC_DATE)

---
select DISTRIBUTOR,name,t.LDESC as'Town Distributor' from DISTRIBUTOR d
left join TOWN t on t.TOWN = d.TOWN 


----

select cm.distributor ,ct.LDESC as 'Cashmemo Type',count(cm.doc_no) 
from cashmemo cm 
left join CASHMEMO_TYPE ct on ct.CASHMEMO_TYPE = cm.CASHMEMO_TYPE
where cm.VISIT_TYPE = '88' and MONTH(cm.DOC_DATE)  in ('11') and cm.CASHMEMO_TYPE in ('05','06')
group by cm.distributor ,ct.LDESC

-----
select sum(((cd.REF_QTY1*s.SELL_FACTOR1)+ (cd.REF_QTY2*s.SELL_FACTOR2)+cd.REF_QTY3)* pc.PRICE_UNIT3) GSV
from CASHMEMO cm 
join  CASHMEMO_DETAIL  cd on cd.DOC_NO = cm.DOC_NO and cd.DISTRIBUTOR = cm.DISTRIBUTOR
left join SKU s on s.SKU = cd.SKU
left join (
SELECT distributor, SKU,PRICE_STRUC,EFFECTIVE_DATE,
		LEAD(EFFECTIVE_DATE,1,'99991231') OVER (PARTITION BY distributor,SKU ORDER BY EFFECTIVE_DATE) AS END_DATE,
		PRICE_UNIT3
	FROM PRICE_STRUCTURE) pc on pc.SKU =cd.SKU and pc.DISTRIBUTOR = cd.DISTRIBUTOR and cd.DOC_DATE between pc.EFFECTIVE_DATE and pc.END_DATE
where cm.VISIT_TYPE = '02' 
and cm.SUB_DOCUMENT not in ('02','04')
and cm.DOC_DATE between '20191001' and '20191231'
and cm.DISTRIBUTOR in ('15061942',
'15083075','15094446','15119645','15132240','15164231','15167515','15178231','15198408','15207803','15217511','15228793','15230292','15240962','15086082','15162280','15167935',
'15195377','15234930','15268038','15279835','15081408','15132762','15146248','15195745','15231072','15279375','15109121','15251536','15300300','15121701','15250153','15072228',
'15261370','15361000','15369350','15390663','15409221','15368653','15420299','15342449','91017001','93004001','93011001','93010001','93012001','15141333','15178640','91406001',
'93009001','15474129','94005101','93026001','94008001','15111550','94027001','93517001','94415001','94432001','15210895','94282001','94458001','94461001','94435001','94418001',
'94228001','94434001','94421001','91009001','94801001','94812001','94463001','94809001','94810001','94803001')